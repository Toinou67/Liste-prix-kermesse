<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Untitled</title>
  

</head>
<body>
<!-- partial:index.partial.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Liste avec compteurs synchronisés Firebase</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    ul { padding-left: 0; }
    li { list-style: none; margin-bottom: 10px; background: #f0f0f0; padding: 10px; border-radius: 6px; display: flex; align-items: center; justify-content: space-between; }
    .item-text { flex-grow: 1; }
    .buttons { display: flex; gap: 6px; align-items: center; }
    button { padding: 4px 8px; font-size: 14px; }
    .counter { min-width: 30px; text-align: center; font-weight: bold; }
    .price, .subtotal { min-width: 60px; text-align: right; margin-left: 10px; font-weight: bold; }
    #totalPrice { margin-top: 20px; font-size: 18px; font-weight: bold; text-align: right; }
    input[type="number"] { width: 80px; margin-left: 10px; }
  </style>
</head>
<body>

  <h1>Liste avec compteurs synchronisés Firebase</h1>

  <!-- Ajout d'un champ prix -->
  <input type="text" id="itemInput" placeholder="Nouvel élément" />
  <input type="number" id="priceInput" placeholder="Prix (€)" step="0.01" min="0" />
  <button onclick="addItem()">Ajouter</button>

  <ul id="list"></ul>

  <div id="totalPrice">Total : 0 €</div>

  <!-- Firebase SDKs (compat version) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCDRv2XNNwYNYmTmC9UZh3zcYQAwg24AZ8",
      authDomain: "liste-kermesse.firebaseapp.com",
      databaseURL: "https://liste-kermesse-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "liste-kermesse",
      storageBucket: "liste-kermesse.firebasestorage.app",
      messagingSenderId: "284160101441",
      appId: "1:284160101441:web:d21556172c4d76b1100ac0",
      measurementId: "G-TW3B8L3Y5Y"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const listRef = db.ref('items');

    let items = [];

    listRef.on('value', (snapshot) => {
      const data = snapshot.val();
      items = data ? Object.values(data) : [];
      renderList();
    });

    function renderList() {
      const ul = document.getElementById('list');
      ul.innerHTML = '';

      let total = 0;

      items.forEach((item, index) => {
        const li = document.createElement('li');

        const spanText = document.createElement('span');
        spanText.className = 'item-text';
        spanText.textContent = item.text;

        // Affichage prix à côté du texte
        const priceSpan = document.createElement('span');
        priceSpan.className = 'price';
        priceSpan.textContent = item.price.toFixed(2) + " €";

        // Affichage compteur
        const counterSpan = document.createElement('span');
        counterSpan.className = 'counter';
        counterSpan.textContent = item.count;

        // Calcul sous-total (count * price)
        const subtotal = item.count * item.price;
        total += subtotal;
        const subtotalSpan = document.createElement('span');
        subtotalSpan.className = 'subtotal';
        subtotalSpan.textContent = subtotal.toFixed(2) + " €";

        const buttonsDiv = document.createElement('div');
        buttonsDiv.className = 'buttons';

        const btnPlus = document.createElement('button');
        btnPlus.textContent = '+';
        btnPlus.onclick = () => {
          updateCount(index, item.count + 1);
        };

        const btnMinus = document.createElement('button');
        btnMinus.textContent = '-';
        btnMinus.onclick = () => {
          if (item.count > 0) updateCount(index, item.count - 1);
        };

        const btnDelete = document.createElement('button');
        btnDelete.textContent = '✕';
        btnDelete.style.color = 'red';
        btnDelete.onclick = () => {
          deleteItem(index);
        };

        buttonsDiv.appendChild(btnPlus);
        buttonsDiv.appendChild(counterSpan);
        buttonsDiv.appendChild(btnMinus);
        buttonsDiv.appendChild(btnDelete);

        li.appendChild(spanText);
        li.appendChild(priceSpan);      // Ajout prix à droite du texte
        li.appendChild(buttonsDiv);
        li.appendChild(subtotalSpan);   // Ajout sous-total à droite

        ul.appendChild(li);
      });

      // Affiche le total général
      document.getElementById('totalPrice').textContent = "Total : " + total.toFixed(2) + " €";
    }

    function addItem() {
      const input = document.getElementById('itemInput');
      const priceInput = document.getElementById('priceInput');
      const text = input.value.trim();
      const price = parseFloat(priceInput.value);

      if (!text) return alert("Merci de saisir un nom d'élément.");
      if (isNaN(price) || price < 0) return alert("Merci de saisir un prix valide (≥ 0).");

      const newItem = { text, count: 0, price };
      const newItemRef = listRef.push();
      newItemRef.set(newItem);

      input.value = '';
      priceInput.value = '';
      input.focus();
    }

    function updateCount(index, newCount) {
      listRef.once('value', snapshot => {
        const data = snapshot.val();
        if (!data) return;
        const keys = Object.keys(data);
        const key = keys[index];
        if (!key) return;
        listRef.child(key).update({ count: newCount });
      });
    }

    function deleteItem(index) {
      listRef.once('value', snapshot => {
        const data = snapshot.val();
        if (!data) return;
        const keys = Object.keys(data);
        const key = keys[index];
        if (!key) return;
        listRef.child(key).remove();
      });
    }
  </script>

</body>
</html>
<!-- partial -->
  
</body>
</html>
